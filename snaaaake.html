<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
    <script>
      var config = {
          type: Phaser.WEBGL,
          width: 800,
          height: 630,
          scene: {
              preload: preload,
              create: create,
              update: update
          }
      };
      var game = new Phaser.Game(config);

      var grid;
      var snake;
      var pellet;
      var cursors;
      var scoreText;

      var UP = 0;
      var DOWN = 1;
      var LEFT = 2;
      var RIGHT = 3;

      function preload()
      {
        this.load.image('snake', 'assets/snake.png')
        this.load.image('pill', 'assets/pill.png')
        this.load.image('portal', 'assets/portal.png')
      }

      function create()
      {
        grid = this.add.grid(0, 0, 800, 600, 20, 20, 0x000000, 1, 0xffffff, 0.5);
        grid.setOrigin(0);
        this.add.rectangle(0, 0, 800, 600)


        var Snake = new Phaser.Class(
          {
            initialize:

             function Snake (scene, x, y)
             {
                 this.headPosition = new Phaser.Geom.Point(x, y);

                 this.body = scene.add.group();

                 this.head = this.body.create(x * 20, y * 20, 'snake');

                 this.head.setOrigin(0);

                 this.alive = true;

                 this.speed = 100;

                 this.moveTime = 0;

                 this.tail = new Phaser.Geom.Point(x, y);

                 this.score = 0

                 this.heading = null;
                 this.direction = null;
             },

             update: function (time)
             {
                 if (time >= this.moveTime)
                 {
                     return this.move(time);
                 }
             },

             faceLeft: function ()
             {
                 if (this.direction === UP || this.direction === DOWN || this.direction === null)
                 {
                     this.heading = LEFT;
                 }
             },

             faceRight: function ()
             {
                 if (this.direction === UP || this.direction === DOWN || this.direction === null)
                 {
                     this.heading = RIGHT;
                 }
             },

            faceUp: function ()
             {
                 if (this.direction === LEFT || this.direction === RIGHT || this.direction === null)
                 {
                     this.heading = UP;
                 }
             },

             faceDown: function ()
             {
                 if (this.direction === LEFT || this.direction === RIGHT || this.direction === null)
                 {
                     this.heading = DOWN;
                 }
             },

             move: function (time)
             {
               switch (this.heading)
              {
                    case LEFT:
                        this.headPosition.x = this.headPosition.x - 1
                        break;

                    case RIGHT:
                        this.headPosition.x = this.headPosition.x + 1
                        break;

                    case UP:
                        this.headPosition.y = this.headPosition.y - 1
                        break;

                    case DOWN:
                        this.headPosition.y = this.headPosition.y + 1
                        break;
              }

                 this.direction = this.heading;
                 Phaser.Actions.ShiftPosition(this.body.getChildren(), this.headPosition.x * 20, this.headPosition.y * 20, 1, this.tail);
                 this.moveTime = time + this.speed;
                 return true;
             },

             grow: function(){
               var newPart = this.body.create(this.tail.x, this.tail.y, 'snake');
               this.score += 1
               newPart.setOrigin(0);
               scoreText.setText('Score: ' + snake.score)
             },


             collideWithFood : function (pill){
               if(this.headPosition.x === (pill.x / 20) && this.headPosition.y === (pill.y / 20))
               {
                 pill.consume();
                 this.grow()

               }
             }


         });

         var Pill = new Phaser.Class({

           Extends: Phaser.GameObjects.Image,

           initialize:

           function Pill(scene, x, y)
           {
            Phaser.GameObjects.Image.call(this, scene)

            this.setTexture('pill');
            this.setPosition(x * 20, y * 20);
            this.setOrigin(0);

            this.total = 0;

            scene.children.add(this);
           },

           consume: function(){
             var x = Phaser.Math.Between(0, 39);
             var y = Phaser.Math.Between(0, 29);

             this.setPosition(x * 20, y * 20);
           }
         });

         var Portal = new Phaser.Class({
           Extends: Phaser.GameObjects.Image,

           initialize:

           function Portal(scene, x, y)
           {
             Phaser.GameObjects.Image.call(this, scene)

             this.setTexture("portal")
             this.setPosition(x * 20, y * 20)
             this.setOrigin(0)

             scene.children.add(this)
           }
         })



         snake = new Snake(this, Math.floor(Math.random() * 40), Math.floor(Math.random() * 30));
         pill = new Pill(this, Math.floor(Math.random() * 40), Math.floor(Math.random() * 30));
         portal = new Portal(this, Math.floor(Math.random() * 40), Math.floor(Math.random() * 30));
         cursors = this.input.keyboard.createCursorKeys();
         toDisplay = "Score: " + snake.score
         scoreText = this.add.text(16, 600, toDisplay, { fontSize: '32px'})
     }

     function update (time, delta)
     {
         if (!snake.alive)
         {
             return;
         }

         if (cursors.left.isDown)
         {
             snake.faceLeft();
         }
         else if (cursors.right.isDown)
         {
             snake.faceRight();
         }
         else if (cursors.up.isDown)
         {
             snake.faceUp();
         }
         else if (cursors.down.isDown)
         {
             snake.faceDown();
         }

         if(snake.update(time)){
           snake.collideWithFood(pill);
         }

         if(cursors.space.isDown){
           this.input.keyboard.resetKeys()
           snake.grow();
         }
     }
    </script>
</body>
</html>
